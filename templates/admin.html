<!DOCTYPE html>
<html>
<head>
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ñ–ö–• –ö–æ—Ä–æ–ª–µ–≤–∫–∞</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* ======== –°–í–ï–¢–õ–ê–Ø –¢–ï–ú–ê ======== */
        :root {
            --bg-color: #f8f9fa;
            --card-bg: white;
            --text-color: #212529;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --table-header-bg: #f8f9fa;
            --table-hover: #f2f2f2;
            --btn-primary: #0d6efd;
            --btn-success: #198754;
            --btn-danger: #dc3545;
            --btn-warning: #ffc107;
            --btn-info: #0dcaf0;
        }

        /* ======== –¢–Å–ú–ù–ê–Ø –¢–ï–ú–ê ======== */
        [data-theme="dark"] {
            --bg-color: #1a1e24;
            --card-bg: #2a2f3c;
            --text-color: #e9ecef;
            --text-muted: #adb5bd;
            --border-color: #4a4f62;
            --table-header-bg: #2a2f3c;
            --table-hover: #3a4050;
            --btn-primary: #6c5ce7;
            --btn-success: #20c997;
            --btn-danger: #e74c3c;
            --btn-warning: #f39c12;
            --btn-info: #3498db;
        }

        body { 
            background: var(--bg-color); 
            color: var(--text-color);
            transition: all 0.3s ease;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .card {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .card-header {
            background: var(--card-bg);
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            border-radius: 15px 15px 0 0 !important;
            padding: 1rem 1.5rem;
        }
        .table {
            color: var(--text-color);
            margin-bottom: 0;
        }
        .table thead th {
            background: var(--table-header-bg);
            color: var(--text-color);
            border-color: var(--border-color);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .table td {
            border-color: var(--border-color);
            vertical-align: middle;
            font-size: 0.9rem;
        }
        .table-hover tbody tr:hover {
            background: var(--table-hover);
            color: var(--text-color);
        }
        .badge {
            font-size: 0.8rem;
            padding: 0.4rem 0.6rem;
            font-weight: 500;
        }
        .btn {
            border-radius: 10px;
            padding: 0.5rem 1.2rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-sm {
            padding: 0.25rem 0.8rem;
            font-size: 0.8rem;
        }
        .btn-primary {
            background: var(--btn-primary);
            border-color: var(--btn-primary);
        }
        .btn-primary:hover {
            background: var(--btn-primary);
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .btn-success {
            background: var(--btn-success);
            border-color: var(--btn-success);
        }
        .btn-success:hover {
            background: var(--btn-success);
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .btn-danger {
            background: var(--btn-danger);
            border-color: var(--btn-danger);
        }
        .btn-danger:hover {
            background: var(--btn-danger);
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .btn-warning {
            background: var(--btn-warning);
            border-color: var(--btn-warning);
            color: #000;
        }
        .btn-warning:hover {
            background: var(--btn-warning);
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .btn-info {
            background: var(--btn-info);
            border-color: var(--btn-info);
            color: #000;
        }
        .btn-info:hover {
            background: var(--btn-info);
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* ======== –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –¢–ï–ú ======== */
        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .theme-switch {
            display: inline-block;
            height: 34px;
            position: relative;
            width: 60px;
        }
        .theme-switch input {
            display: none;
        }
        .slider {
            background: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            background: white;
            bottom: 4px;
            content: "‚òÄÔ∏è";
            height: 26px;
            left: 4px;
            position: absolute;
            transition: .4s;
            width: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        input:checked + .slider {
            background: #2c3e50;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
            content: "üåô";
        }
        .theme-label {
            margin-right: 10px;
            color: var(--text-color);
            font-weight: 500;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ */
        .moderated-row {
            background-color: rgba(40, 167, 69, 0.05) !important;
        }
        .unmoderated-row {
            background-color: rgba(255, 193, 7, 0.05) !important;
        }
        .stats-summary {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .stat-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px 25px;
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--btn-primary);
        }
        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .filter-badge {
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 20px;
            background: var(--table-hover);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        .filter-badge.active {
            background: var(--btn-primary);
            color: white;
            border-color: var(--btn-primary);
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4 px-4">
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º -->
        <div class="theme-switch-wrapper">
            <span class="theme-label">–¢–µ–º–∞:</span>
            <label class="theme-switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="display-6 fw-bold mb-1">üîê –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                <p class="text-muted mb-0">–º–∫—Ä –ö–æ—Ä–æ–ª–µ–≤–∫–∞, –≥. –°–º–æ–ª–µ–Ω—Å–∫</p>
            </div>
            <a href="/logout" class="btn btn-danger">
                –í—ã–π—Ç–∏
            </a>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-summary">
            <div class="stat-item">
                <div class="stat-value">{{ total_count }}</div>
                <div class="stat-label">–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ moderated_count }}</div>
                <div class="stat-label">–û–¥–æ–±—Ä–µ–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ unmoderated_count }}</div>
                <div class="stat-label">–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
        <div class="export-buttons mb-4">
            <a href="/export/csv" class="btn btn-success">
                üì• –°–∫–∞—á–∞—Ç—å CSV
            </a>
            <a href="/export/excel" class="btn btn-success">
                üìä –°–∫–∞—á–∞—Ç—å Excel
            </a>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="d-flex gap-2 mb-3">
            <span class="filter-badge {% if current_filter == 'all' %}active{% endif %}" 
                  onclick="window.location.href='/admin?filter=all'">
                üóÇÔ∏è –í—Å–µ ({{ total_count }})
            </span>
            <span class="filter-badge {% if current_filter == 'unmoderated' %}active{% endif %}"
                  onclick="window.location.href='/admin?filter=unmoderated'">
                ‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ({{ unmoderated_count }})
            </span>
            <span class="filter-badge {% if current_filter == 'moderated' %}active{% endif %}"
                  onclick="window.location.href='/admin?filter=moderated'">
                ‚úÖ –û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ ({{ moderated_count }})
            </span>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold">üìã –í—Å–µ –æ—Ç–≤–µ—Ç—ã –∂–∏—Ç–µ–ª–µ–π</h5>
                <span class="badge bg-primary fs-6">{{ responses|length }} –∑–∞–ø–∏—Å–µ–π</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>üìç –ê–¥—Ä–µ—Å</th>
                                <th>üßπ –£–±–æ—Ä–∫–∞</th>
                                <th>üí° –û—Å–≤–µ—â–µ–Ω–∏–µ</th>
                                <th>üõó –õ–∏—Ñ—Ç</th>
                                <th>‚ùÑÔ∏è –¢—Ä–æ—Ç—É–∞—Ä—ã</th>
                                <th>‚ùÑÔ∏è –î–æ—Ä–æ–≥–∏</th>
                                <th>üåô –£–ª–∏—Ü–∞</th>
                                <th>üóëÔ∏è –ú—É—Å–æ—Ä</th>
                                <th>‚úÖ –°—Ç–∞—Ç—É—Å</th>
                                <th>‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in responses %}
                            <tr class="{% if r.moderated %}moderated-row{% else %}unmoderated-row{% endif %}">
                                <td><span class="fw-bold">#{{ r.id }}</span></td>
                                <td>{{ r.timestamp.strftime('%d.%m.%Y %H:%M') if r.timestamp else '‚Äî' }}</td>
                                <td>
                                    <span class="badge bg-secondary">
                                        üìç {{ r.address or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                                    </span>
                                </td>
                                
                                <!-- –£–±–æ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–æ–¥—ä–µ–∑–¥–∞ -->
                                <td>
                                    {% if r.cleaning_inside is not none %}
                                        <span class="badge bg-{{ 'success' if r.cleaning_inside >= 4 else 'warning' if r.cleaning_inside == 3 else 'danger' }}">
                                            {{ r.cleaning_inside }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <!-- –û—Å–≤–µ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –ø–æ–¥—ä–µ–∑–¥–∞ -->
                                <td>
                                    {% if r.lighting_inside is not none %}
                                        <span class="badge bg-{{ 'success' if r.lighting_inside >= 4 else 'warning' if r.lighting_inside == 3 else 'danger' }}">
                                            {{ r.lighting_inside }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <!-- –†–∞–±–æ—Ç–∞ –ª–∏—Ñ—Ç–∞ -->
                                <td>
                                    {% if r.elevator is not none %}
                                        <span class="badge bg-{{ 'success' if r.elevator >= 4 else 'warning' if r.elevator == 3 else 'danger' }}">
                                            {{ r.elevator }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <!-- –°–Ω–µ–≥ —Ç—Ä–æ—Ç—É–∞—Ä—ã -->
                                <td>
                                    {% if r.snow_sidewalks is not none %}
                                        <span class="badge bg-{{ 'success' if r.snow_sidewalks >= 4 else 'warning' if r.snow_sidewalks == 3 else 'danger' }}">
                                            {{ r.snow_sidewalks }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <!-- –°–Ω–µ–≥ –¥–æ—Ä–æ–≥–∏ -->
                                <td>
                                    {% if r.snow_road is not none %}
                                        <span class="badge bg-{{ 'success' if r.snow_road >= 4 else 'warning' if r.snow_road == 3 else 'danger' }}">
                                            {{ r.snow_road }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <!-- –£–ª–∏—á–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ -->
                                <td>
                                    {% if r.lighting_outside is not none %}
                                        <span class="badge bg-{{ 'success' if r.lighting_outside >= 4 else 'warning' if r.lighting_outside == 3 else 'danger' }}">
                                            {{ r.lighting_outside }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <!-- –í—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞ -->
                                <td>
                                    {% if r.garbage is not none %}
                                        <span class="badge bg-{{ 'success' if r.garbage >= 4 else 'warning' if r.garbage == 3 else 'danger' }}">
                                            {{ r.garbage }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">‚Äî</span>
                                    {% endif %}
                                </td>
                                
                                <td>
                                    {% if r.moderated %}
                                        <span class="badge bg-success">‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ</span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        {% if not r.moderated %}
                                        <button class="btn btn-success btn-sm" onclick="moderate({{ r.id }}, 'approve')">
                                            ‚úÖ
                                        </button>
                                        {% endif %}
                                        <button class="btn btn-danger btn-sm" onclick="moderate({{ r.id }}, 'delete')">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="12" class="text-center py-5">
                                    <h4 class="text-muted mb-3">üò¢ –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</h4>
                                    <p class="mb-0">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –ø—Ä–æ–π–¥–µ—Ç –æ–ø—Ä–æ—Å!</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="mt-4 d-flex gap-2">
            <a href="/" class="btn btn-primary">
                –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
            <a href="/results" class="btn btn-success">
                üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
            </a>
        </div>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
    <script>
        function moderate(id, action) {
            if (action === 'delete' && !confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç?')) {
                return;
            }
            
            fetch(`/moderate/${id}/${action}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º
        const toggleSwitch = document.querySelector('#theme-toggle');
        const currentTheme = localStorage.getItem('theme');

        if (currentTheme) {
            document.documentElement.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark') {
                toggleSwitch.checked = true;
            }
        }

        function switchTheme(e) {
            if (e.target.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }    
        }

        toggleSwitch.addEventListener('change', switchTheme, false);
    </script>
</body>
</html>
